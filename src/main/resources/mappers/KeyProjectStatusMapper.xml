<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.swpu.uchain.openexperiment.dao.KeyProjectStatusMapper">


    <insert id="insert">
        insert into key_project_status(project_id,`status`,subordinate_college,creator_id)
            values (#{projectId},#{status},#{college},#{creatorId})
    </insert>
        <update id="update">
        update key_project_status set `status` = #{status} where project_id = #{projectId}
    </update>
    <update id="updateList">
        update key_project_status set `status` = #{status}
            where project_id in
                  <foreach collection="list" item="projectId" open="(" close=")" separator=",">
                      #{projectId}
                  </foreach>
    </update>
    <select id="getStatusByProjectId" resultType="java.lang.Integer">
        select status from key_project_status where project_id = #{projectId}
    </select>
    <select id="getKeyProjectDTOListByStatusAndCollege" resultType="com.swpu.uchain.openexperiment.DTO.KeyProjectDTO">
        SELECT
            key_project_status.project_id AS id,
            key_project_status.`status` AS STATUS,
            key_project_status.create_time AS createTime,
            project_group.apply_funds AS applyFunds,
            project_group.project_name AS projectName,
            project_group.lab_name AS labName,
            project_group.address AS address,
            project_group.main_Content AS mainContent,
            `user`.real_name AS creatorName,
            `user`.`code` AS userId
            FROM
            key_project_status
            INNER JOIN project_group ON key_project_status.project_id = project_group.id
            LEFT JOIN `user` ON key_project_status.creator_id = `user`.code;
        <where>
            <if test="status!=null">
                and `status` = #{status}
            </if>
            <if test="college!=null">
                and college = #{college}
            </if>
        </where>

    </select>
    <select id="getKeyProjectListByUserId" resultType="com.swpu.uchain.openexperiment.DTO.KeyProjectDTO">
        SELECT
        DISTINCT
        project_group.id AS id,
        project_group.apply_funds AS applyFunds,
        project_group.main_Content AS mainContent,
        project_group.address,
        project_group.lab_name AS labName,
        project_group.project_name AS projectName,
        key_project_status.`status` AS STATUS,
        key_project_status.create_time AS createTime,
        `user`.real_name AS creatorName
        FROM
        user_project_group,
        project_group
        INNER JOIN key_project_status ON project_group.id = key_project_status.project_id
        left join `user` on key_project_status.creator_id = user.`code`
        WHERE
        `user_project_group`.`user_id` = #{userId}
        <if test="status!=null">
            and key_project_status.`status` = #{status}
        </if>
    </select>


</mapper>

